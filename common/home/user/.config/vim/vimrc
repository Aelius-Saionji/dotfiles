" --- Base config --- "

" XDG compliant environment
if has('unix')
  silent !mkdir -p $HOME/.cache/vim
  set directory=$HOME/.cache/vim,~/,/tmp
  set backupdir=$HOME/.cache/vim,~/,/tmp
  set viminfo+=n$HOME/.cache/vim/viminfo
  set runtimepath=$HOME/.config/vim,$HOME/.config/vim/after,$VIM,$VIMRUNTIME
  if has('gui_running')
    source $HOME/.config/vim/gvimrc
  endif
endif
if has('win32') || has('win64')
  silent !mkdir "%HOME%\.cache\vim"
  set directory=~/.cache/vim,~/
  set backupdir=~/.cache/vim,~/
  set viminfo+=n~/.cache/vim/viminfo
endif
" Enforce UTF-8
set encoding=utf-8
" When no filetype-specific indenting is enabled, new lines inherit above indentation
set autoindent
" Set the command window height to 2 lines, to avoid many cases of having to press <Enter> to continue
set cmdheight=2
" Always display the status line, even if only one window is displayed
set laststatus=2
" Switch on search pattern highlighting.
set hlsearch
" Set enrcyption method to blowfish
set cryptmethod=blowfish2
" Make vim case insensitive...
set ignorecase
" ...Except when we explicitly type a capital
set smartcase
" Jump to matches as you search
set incsearch
" Indicate a line is wrapped with '> '
set showbreak=>\ 
" Indent a wrapped line
set breakindent
" Wrap per word, not character (configured with 'breakat')
set linebreak
" Indent tabs less
set tabstop=2
set shiftwidth=2
" Use spaces instead of tabs
set expandtab
" Make backspace work as expected
set backspace=indent,eol,start
" Highlight strings inside C comments
let c_comment_strings=1
" Theme
colorscheme torte
" My own mru solution using dmenu
"noremap <C-p> :wv<CR>:e <C-r>=system("mruvim p")<CR><CR>
" Exit insert mode with jj
inoremap jj <Esc>
" Elevate vim under windows. Update me to use powershell elevation
"noremap <C-e> :mksession! ~/vimfiles/elevate.vim<Return>:silent exec '!elevate.exe ' . v:progname '-S C:/Users/Link/vimfiles/elevate.vim --cmd "let $HOME=''C:\Users\Link\''"'<Return>:q<Return>
" Don't write viminfo while editing an encrypted file
augroup Security
  autocmd vimleavepre * if strlen(&key) | set viminfo= | endif
augroup End

" --- Plugin config --- "

" Vim-plug package manager
call plug#begin()
" UI
Plug 'bling/vim-airline' "Fancy statusbar
Plug 'junegunn/goyo.vim' "Distraction free reading and writing
Plug 'junegunn/limelight.vim' "Highlight current paragraph
" Tools
Plug 'ervandew/supertab' "Tab completion
Plug 'godlygeek/tabular' "Format tables
Plug 'reedes/vim-pencil' "Auto apply textwidth formatting in real time
Plug 'chilicuil/vim-sprunge' "Dump buffer to a pastebin
Plug 'tpope/vim-vinegar' "Improve internal file browser
Plug 'junegunn/fzf' "Navigate buffers, history, etc
Plug 'junegunn/fzf.vim' "Navigate buffers, history, etc
Plug 'Konfekt/FastFold' "Probably improves performance with many folds??
Plug 'tpope/vim-commentary' "Comment/uncomment a range
Plug 'tpope/vim-surround' "Commands to manipulate surrounding tags/quotes/other
" Syntax
Plug 'plasticboy/vim-markdown' "Markdown support
Plug 'PProvost/vim-ps1' "Powershell support
call plug#end()

" Fzf buffers
nnoremap <silent> <Leader>b :Buffers<CR>
" Fzf history
nnoremap <silent> <Leader>h :History<CR>
" Fzf commands
nnoremap <silent> <Leader>; :Commands<CR>

" Grey comments, must be declared after Vim-plug
highlight Comment ctermfg=8 guifg=#808080
