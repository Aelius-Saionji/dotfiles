#!/bin/sh

# Right alt is considered mod4
xmodmap -e "keycode 108 = Super_L"
xmodmap -e "remove mod1 = Super_L"

# Get device type
chassis="$(hostnamectl | sed -e '/Chassis/!d' -e 's/^.*Chassis: //')"
# laptop specific commands
if [ $chassis = "laptop" ]; then
	# Disable touchpad while typing
	# https://wiki.archlinux.org/index.php/Touchpad_Synaptics#Using_.xinitrc
	syndaemon -t -k -i 2 &
	# The following is set against Saya's clickpad
	# Pressure required for movement
	synclient FingerHigh=45
	# Speed
	synclient MinSpeed=0.5
	synclient MaxSpeed=3
	synclient AccellFactor=0.5
	# "Natural" scrolling
	synclient HorizScrollDelta=-100
	synclient VertScrollDelta=-100
fi

# Get the hostname
host="$(hostnamectl status --static)"
# Saya specific commands
if [ $host = "Saya" ]; then
	# Power button is Insert
	xmodmap -e "keycode 124 = Insert"
	### REMINDER! LEAVE AT LEAST ONE Fkey SO YOU CAN GET TO THE TTY ###
		# These keybindings are isolated within X, so all TTYs are still reachable.
	# Rebind F1 and F2 to PgUP and PgDown
		# not good enough for dvtm
	xmodmap -e "keycode 67 = Page_Up"
	xmodmap -e "keycode 68 = Page_Down"
	# Rebind F6-F10 to work as expected
	xmodmap -e "keycode 72 = XF86MonBrightnessDown"
	xmodmap -e "keycode 73 = XF86MonBrightnessUp"
	xmodmap -e "keycode 74 = XF86AudioMute"
	xmodmap -e "keycode 75 = XF86AudioLowerVolume"
	xmodmap -e "keycode 76 = XF86AudioRaiseVolume"
	# This is a clickpad but for some reason I have to lie
	synclient ClickPad=0
	# Two finger tap is right click
	synclient TapButton2=3
	# Three finger click is middle click
	synclient Clickfinger3=2
	# Disable tap middle click
	synclient TapButton3=-1
	# Two finger scrolling
	synclient VertTwoFingerScroll=1
	synclient HorizTwoFingerScroll=1
	# Locked drags because mac touchpads are stupid
	# synclient LockedDrags=1
	# synclient LockedDragTimeout=2000
	# Pressure required for movement
	synclient FingerHigh=45
	# Speed
	synclient MinSpeed=0.5
	synclient MaxSpeed=3
	synclient AccellFactor=0.5
	# "Natural" scrolling speed
	synclient HorizScrollDelta=-100
	synclient VertScrollDelta=-100
elif [ $host = "GIR" ]; then
	# appskey=F13, where F13 is dvtm mod
	xmodmap -e "keycode 135 = F13"
	# Rotate button keysym
	xmodmap -e "keycode 161 = XF86Display"
elif [ $host = "Talim" ]; then
	# Appskey=F13, where F13 is dvtm mod
	xmodmap -e "keycode 135 = F13"
	# Rotate button keysym
	xmodmap -e "keycode 161 = XF86Display"
	# Speed 
	synclient MinSpeed=0.5
	synclient MaxSpeed=2
	synclient AccellFactor=0.5
	# Pressure required for movement
	synclient FingerHigh=45
	# Circular Scrolling
	synclient CircularScrolling=1
	# Detect from right edge only
	synclient CircScrollTrigger=3
	# Slow down scrolling (lower is faster)
	synclient CircScrollDelta=0.7
	# Side scroll area doesn't work with circular, disable it
	synclient VertEdgeScroll=0
	# "Natural" scrolling speed (does nothing with circular on)
	synclient VertScrollDelta=-450
fi

# Startup processes
cp ~/.config/compton.conf /tmp/compton.conf
compton -b --config /tmp/compton.conf
clipmenud &
redshift -l 42:-73 &
#statnot &
twmnd &
systemctl --user start feh-wallpaper.service
xss-lock -l slock &
while true; do dwmstatus.sh; sleep 10; done &
while true; do st -c st-256color -e dvtm -M; done &

while true; do
    # Log stderror to a file 
    dwm 2> ~/.dwm.log
    # No error logging
    #dwm >/dev/null 2>&1
done
