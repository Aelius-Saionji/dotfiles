" Loads plugins before trying to set options
loadplugins '\.(js|penta)$'

map -ex <F1> emenu Help.About Firefox
map -builtin -modes insert jj <ESC>
map -ex -modes normal C winclose
map -modes normal ZR -ex restart
map -builtin -modes normal x :emenu<Space>
map -builtin <A-c> :cookies<Space><Tab>
map -ex <A-d> downloads
map -ex <C-S-p> private winopen
map -description 'Do not map me!' s <nop>
map -ex <F2> set! flashgot.defaultDM=curl
map -ex <C-F2> set! flashgot.defaultDM=mpv
map -ex <F3> emenu View.Open with mpv
map -ex <F4> emenu View.Open with IE
map -builtin -modes normal d <C-w>

" View addons in the cmdline
map -ex <C-A-a> addons

" Replace penta's mapping with the firefox default action
map -ex <C-b> emenu View.Sidebar.Bookmarks

" Begin a 7s timer with sb, uses Imageforward extension
"map -javascript si pop = setInterval("gImageForward.iterateImageLinks()", 7000);

" Finish the timer with sf
"map -javascript sf clearInterval(pop);

" End image forward's slideshow
"map -javascript sb gImageForward.abortIteration();

" Toggle show/hide tabs with ctrl t. Toggles the tree autohide when tree is 'stowed'
map -ex <C-t> set showtabline!=never,always
" I think I can workaround the bug with :js command? Idk. Here's an alternative
" st[owe] the tree!
"map -ex st set! extensions.treestyletab.tabbar.autoHide.mode=1
" Se[e] the tree!
"map -ex se set! extensions.treestyletab.tabbar.autoHide.mode=0

" Shift enter to run the first result
map -builtin -modes command-line <S-Return> <Tab><Return>

" Make it easier to add tags to bookmarks
map -builtin -modes normal a a -tags 

" Make sc center the selected text & draw a box
map -modes normal -ex sc centerselect

" De-hilight, deselect, unbox search terms on page redraw (ctrl l)
map -builtin <C-l> :nohlfind | :removeselect<Return><C-l><Esc>

" Make ctrl a select all in insert mode
map -modes input -builtin <C-a> <C-v><C-a>

" Make paste work the first time in insert mode
map -modes input -builtin <C-v> <C-v><C-v>

" Make undo work in insert mode
map -modes input -builtin <C-z> <C-v><C-z>

" Yank site url and title
map -modes normal -ex Ya js util.copyToClipboard(buffer.URL+String.fromCharCode(10)+buffer.title)

" Yank site title
map -modes normal -ex Yt js util.copyToClipboard(buffer.title)

" For multi key mappings like st, wait infinitely after pressing the s key
set notimeout

set downloadsort=-active,-date
set guioptions=s
set showtabline=never
set hlfind

" Disable bell beep on errors
" javascript dactyl.beep = function() { return false; }

" After closing a tab, display to the last viewed tab.
set tabclose=previous

set defsearch=bing
set complete=location,search,bookmark,file,suggestion
"set complete=AlertBox,location,search,bookmark,file,suggestion

" Define which engines to get suggestions from in a generic search
set suggestengines=bing

" Smooth scrolling steps. Default is 5, 1 disables.
set scrollsteps=3

" Make sure cookies are rejected by default
set cookieaccept=none

" Set the cmd directory to home folder
silent cd ~

" Play a wav when downloads finish
autocmd DownloadPost -javascript * Audio("file://c:/users/Link/pentadactyl/masseffectbeep.wav").play()

" Type goi to open imgur...
silent qmark 4 https://boards.4chan.org/h
silent qmark i http://imgur.com
silent qmark h about:blank
silent qmark o https://bay171.mail.live.com/default.aspx?id=64855&owa=1&owasuffix=owa/
silent qmark w http://wallhaven.cc/

" Newer pentadactyl broke colorscheme
" colorscheme desert-mod

" Hide tab close button
style -name hide-tab-close-button chrome://* .tabbrowser-tab .tab-close-button { visibility: collapse !important; }
" Wallpaper for about:blank
style -name blank-wallpaper about:blank @-moz-document url("about:blank") {body:empty:not([style]):not([text]):not([class]):not([onresize]) { background: url("file:///C:/Users/Link/pentadactyl/cerberus.png") no-repeat !important; background-size: 100% !important; background-color: black !important; }}
" Wallpaper for about:newtab
style -name newtab-wallpaper about:newtab #newtab-scrollbox{ background: url("file:///C:/Users/Link/pentadactyl/cerberus.png") no-repeat !important; background-size: 100% !important; background-color: black !important; }
" Temporary fix for newer pentadactyl fuqing up tabs
"style -name tabbrowser-height-fix chrome://* [dactyl-australis=true] .tabbrowser-tabs { max-height: unset !important; }

" Karmablocker forgets the sync address, so let's remind it
"set! extensions.kabl.sync_url=http://flamingsteel.net/a/kabl.ini
" Image Forward, add gif and webm
"set! extensions.imageforward.linkURLRegExp=^[^#\\?]+\\.(jpg\|jpeg\|png\|gif\|webm)((#\|\\?).*)?$
" Don't close the window for the last tab
"set! browser.tabs.closeWindowWithLastTab=false
set! browser.newtab.url=about:blank

" :[tab]open will suggest buffers for the current window and switch to them instead of creating a redundant tab
js <<EOF
overlay.overlayObject(dactyl, {
    open: function open(urls, params, force) {
        if (typeof urls === "string") {
            let matches = urls.match(/^(\d+): /);
            if (matches) {
                tabs.switchTo(urls, true);
                return;
            }
        }
        open.superapply(this, arguments);
    }
});
completion.addUrlCompleter("buffer", "Open Tabs", completion.buffer);
options["complete"].splice(0, 0, "buffer");
EOF
